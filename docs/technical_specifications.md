# Technical Specifications

## 1. Overview

This document details the technical specifications for the zkVote projectâ€”a private, verifiable voting system that utilizes zero-knowledge proofs with the Groth16 proof system. It covers the cryptographic primitives, circuit design, key generation, proof handling, smart contract implementation, and frontend integration.

## 2. Zero-Knowledge Proof Infrastructure

### 2.1 Circom Circuit Design

- **Circuit Language & Version:**
  - Developed in Circom (v2.0.0 or later).
- **Cryptographic Primitives:**
  - **Hash Function:** Utilizes the Poseidon hash function (optimized for SNARKs) to generate vote commitments.
  - **Range Check:** Uses the LessThan component from circomlib to ensure that the vote value is within a valid range.
- **Inputs & Outputs:**
  - **Private Inputs:**
    - `vote` (e.g., candidate ID as an integer).
    - `randomness` (a secret nonce for commitment masking).
  - **Public Input:**
    - `voteCommitment` (the Poseidon hash output computed off-chain).
- **Circuit Constraints:**
  - **Commitment Verification:**
    - The circuit computes `hash(vote, randomness)` and asserts equality with the public `voteCommitment`.
  - **Range Validation:**
    - Ensures `vote < nCandidates + 1` (with an additional check that vote is non-zero if needed).

## 3. Key Generation & Trusted Setup

### 3.1 Powers-of-Tau Ceremony

- **File Requirements:**
  - A pre-generated Powers-of-Tau file (e.g., `pot12_final.ptau`) is required. This file establishes the common reference string (CRS) for the trusted setup.

### 3.2 Groth16 Setup

- **Commands & Tools:**
  - Use `snarkjs` for running the Groth16 setup:
    - **Phase 1:** Compile the circuit to generate R1CS, WASM, and symbol files.
    - **Phase 2:** Generate the witness using the compiled WASM.
    - **Phase 3:** Generate proving and verification keys using the `snarkjs groth16 setup` command.
- **File Structure:**
  - Store the proving key (e.g., `proving_key.json`) and the verification key (e.g., `verification_key.json`) in a secure folder (`/keys`).

## 4. Proof Generation & Verification

### 4.1 Witness Generation

- **Process:**
  - After circuit compilation, generate a witness from the input JSON file using the provided WASM.
- **Command:**
  ```sh
  snarkjs wtns calculate vote.wasm input.json witness.wtns
  ```

### 4.2 Proof Generation

- **Using `snarkjs`:**
  - Generate the proof using the witness and the proving key.
- **Command:**
  ```sh
  snarkjs groth16 prove proving_key.json witness.wtns proof.json public.json
  ```

### 4.3 Local Proof Verification

- **Pre-Deployment Check:**
  - Before on-chain submission, verify the generated proof locally.
- **Command:**
  ```sh
  snarkjs groth16 verify verification_key.json public.json proof.json
  ```

## 5. Smart Contract Implementation

### 5.1 Contract Overview

- **Language & Version:**
  - Written in Solidity (version 0.8.x recommended for its built-in overflow checks).
- **Verifier Contract (`Verifier.sol`):**
  - **Function:**
    - Accepts the proof and public inputs.
    - Uses the embedded verification key to verify the zk-SNARK proof.
  - **Structure:**
    - Functions for proof verification (usually auto-generated by `snarkjs`).
    - Event logging for successful vote recording.

### 5.2 Deployment

- **Tools:**
  - Uses framework Hardhat for compiling, testing, and deploying the smart contracts.
- **On-Chain Interaction:**
  - The smart contract is deployed to a testnet (e.g., Rinkeby, Goerli) for initial testing.

## 6. Frontend Integration

### 6.1 User Interface

- **Technologies:**
  - Next.js
- **Functionality:**
  - Collects voter input (vote selection, optionally randomness if generated client-side).
  - Initiates witness and proof generation via backend integration.
  - Interacts with the smart contract using `ethers.js` to submit proofs and vote commitments.

### 6.2 Web3 Interaction

- **Connecting to the Blockchain:**
  - Uses MetaMask (or other wallet integrations) to allow users to sign and send transactions.
- **Smart Contract Interaction:**
  - The frontend sends the proof and public input data to the smart contract for on-chain verification.

## 7. Deployment Environment & Tooling

### 7.1 Environment Setup

- **Containerized Development Environment:**
  - Use Docker to create a consistent and reproducible development environment.
  - Include all necessary dependencies in your Dockerfile (e.g., Node.js, Circom, `snarkjs`, Hardhat, and `ethers.js`).
  - Ensure that the Docker configuration is version-controlled and uploaded with the repository.
- **Local Development:**
  - Leverage GitHub Codespaces or your local Docker environment to ensure that every team member (or future self) uses an identical setup.
  - Document Docker commands and instructions for building and running the container.

### 7.2 Testing & Continuous Integration

- **Testing:**
  - Unit tests for circuits (using test cases in Circom) and integration tests for smart contracts (via Hardhat) should run inside the Docker container.
  - End-to-end tests for the complete vote casting and on-chain verification workflow should also be containerized.
- **CI/CD Tools:**
  - Use GitHub Actions that support Docker to build the container and run your tests automatically on each commit.
  - This ensures that environment consistency is maintained from development through to deployment.

## 8. Security Considerations

### 8.1 Cryptographic Parameters

- **Bit Lengths & Field Size:**
  - Ensuring that all cryptographic operations (e.g., Poseidon hash, range check) use secure and standardized parameters.

### 8.2 Trusted Setup Security

- **Mitigation:**
  - Considering a multi-party computation (MPC) approach for the trusted setup to prevent any single point of failure.

### 8.3 Smart Contract Security

- **Best Practices:**
  - Following Solidity best practices (e.g., use of latest compiler, proper error handling, and security audits).
  - Consider third-party audits or formal verification for the verifier contract (not applicable for a personal project).

## 9. Summary of Tools & Versions

- **Circom:** v2.0.0+
- **snarkjs:** Latest stable version
- **Solidity:** 0.8.x
- **Node.js:** LTS version
- **Development Framework:** Hardhat
- **Frontend Libraries:** ethers.js
